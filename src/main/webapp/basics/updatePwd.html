<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>修改密码</title>
		<link rel="stylesheet" href="../layui/css/layui.css" media="all">
		<link href="../css/common.css" rel="stylesheet" />
	</head>
	<body>
		<table class="layui-table">
			<!-- <colgroup>
				<col width="150">
				<col width="200">
				<col>
			</colgroup> -->
			<thead>
				<tr>
					<th colspan="3">修改密码</th>
				</tr>
			</thead>
			<tbody id="datalist" lay-filter="test">
				<tr >
					<td>旧密码</td>
					<td><input class="layui-input"  type="password" id="old_password" autocomplete="off" ></td>
				</tr>
				<tr>
					<td>新密码</td>
					<td><input id="new_password" class="layui-input" type="password" autocomplete="off"></td>
				</tr>
				<tr>
					<td>确认密码</td>
					<td><input id="new_password2" type="password" class="layui-input" autocomplete="off"></td>
				</tr>
			</tbody>
		</table>
		<div style="display: flex;justify-content: center;"><button class="layui-btn layui-btn-normal" onclick="updatePwd()">修改密码</button></div>
		<script src="../js/jquery-3.3.1.min.js"></script>
		<script src="../layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript"></script>
		<script>
			// 验证非法登录
			//checkLogin();
		</script>
		<script>
			// 旧密码
			var old_password = ""
			// 新密码
			var new_password = ''
			//确认密码
			var new_password2 = ""
			//pc类型
			var admintype = getCookie('admintype')
			//id
			var adminid = getCookie('adminid')
			//key
			var adminkey = getCookie('adminkey')

			layui.use(['laypage', 'layer', 'form', 'laytpl', 'table', 'laydate'], function() {
				laypage = layui.laypage;
				layer = layui.layer;
				laytpl = layui.laytpl;
				form = layui.form;
				laydate = layui.laydate;
				table = layui.table;
				form.render();
			});

			function updatePwd() {
				// 新密码
				new_password = $("#new_password").val().toString().trim();
				new_password2 = $("#new_password2").val().toString().trim();
				if (new_password != new_password2) {
					layer_msg('前后密码不一致')
					return
				}
				$.ajax({
					type: "post",
					url: '/ESFWeb/api/updatepwd.jsp',
					datatype: 'json',
					data: {
						admintype: admintype,
						adminid: adminid,
						adminkey: adminkey,
						new_password: new_password,
					},
					success: function(data) {
						//var newData=JSON.parse(data);
						var newData = data
						layer.alert(newData.msg,{
							icon:1,
							closeBtn:0
						},function(index){
							//关闭保存成功页面
							layer.close(index);
							//获得当前页面索引
							var indexmain = parent.layer.getFrameIndex(window.name);
							//触发主页面按钮事件,根据不同业务可以在自己页面中修改方法
							parent.getSearchData()
							parent.layer.close(indexmain)
						})
					},
					error: function(e) {
						layer.alert(e.msg,{
							closeBtn:0
						},function(index){
							//关闭保存成功页面
							layer.close(index);
							//获得当前页面索引
							var indexmain = parent.layer.getFrameIndex(window.name);
							//触发主页面按钮事件,根据不同业务可以在自己页面中修改方法
							parent.getSearchData()
							parent.layer.close(indexmain)
						})
					}
				});
			}
			$("#old_password").blur(function(){
				old_password = $("#old_password").val().toString().trim();
				$.ajax({
					type: "post",
					url: '/ESFWeb/api/checkpwd.jsp',
					datatype: 'json',
					data: {
						admintype: admintype,
						adminid: adminid,
						adminkey: adminkey,
						old_password: old_password,
					},
					success: function(data) {
						//var newData=JSON.parse(data);
						var newData = data
						console.log(newData)
						if(newData.key=="FAIL"){layer_msg(newData.msg)}
					},
					error: function(e) {
						console.log(e)
					}
				});
			})
			function checkpwd() {
			}
		</script>
	</body>
</html>
