<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>添加预订</title>
		<link rel="stylesheet" href="../layui/css/layui.css" media="all">
		<link href="../css/common.css" rel="stylesheet" />
	</head>
	<body>
		<div style="text-align: center;">
			<table class="layui-table">
				<tr>
					<td colspan="6" style="font-size: 30px;font-weight: 500;">添加预订信息</td>
				</tr>
				<tr>
					<td>预订编号</td>
					<td><input id="title" type="text" placeholder="1101" class="layui-input" /></td>
				</tr>
				<tr>
					<td>客户编号</td>
					<td><input id="totalarea" type="text" placeholder="请填写身份证号" class="layui-input" /></td>
				</tr>
				<tr>
					<td>房间编号</td>
					<td><input id="height" placeholder="1102" type="text" class="layui-input" /></td>
				</tr>
				<tr>
					<td>预订日期</td>
					<td colspan="5">
						<input type="text" class="layui-input" id="test1">
					</td>
				</tr>
			</table>
			<div style="display: flex;justify-content: center;">
				<button class="layui-btn layui-btn-normal" onclick="addhouse()">提交</button>
				<button class="layui-btn layui-btn-primary" onclick="reset()">重置</button>
			</div>
		</div>
		<script src="../js/jquery-3.3.1.min.js"></script>
		<script src="../layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript"></script>
		<script>
			// 验证非法登录
			//checkLogin();
		</script>
		<script>
			//house_id,area_id,street_id,title,price,unit,createtime,height,totalarea,floor
			//totalfloor,house_no,houseintroduction,address,createuser,saleuser,orderflg,topflg
			//deleteflg,elecflg,soldflg
			layui.use(['laypage', 'layer', 'form', 'laytpl', 'table', 'laydate'], function() {
				laypage = layui.laypage;
				layer = layui.layer;
				laytpl = layui.laytpl;
				form = layui.form;
				laydate = layui.laydate;
				table = layui.table;
				laydate.render({
					elem: '#test1' //指定元素
				});
				//获取业务员信息
				updataPep();
				updataArea();
				form.render();
			});
			//pc类型
			var admintype = getCookie('admintype')
			//id
			var adminid = getCookie('adminid')
			//key
			var adminkey = getCookie('adminkey')
			//获取地区
			function updataArea() {
				$.ajax({
					type: "post",
					url: '/ESFWeb/area/select/all.jsp',
					datatype: 'json',
					data: {
						admintype: admintype,
						adminid: adminid,
						adminkey: adminkey
					},
					success: function(e) {
						var Data = e;
						checkError(Data);
						console.log(Data)
						var inner = '<option value="">请选择地区</option>'
						Data.body.forEach(function(q) {
							inner += '<option value="' + q.area_id + '">' + q.areaname + '</option>'
						})
						document.getElementById('area').innerHTML = inner
						form.render('select');
					},
					error: function(e) {
						console.log('查询失败')
						console.log(e)
					}
				})
			}
			//获取业务员
			function updataPep() {
				$.ajax({
					type: "post",
					url: '/ESFWeb/api/getadmin.jsp',
					datatype: 'json',
					data: {
						admintype: admintype,
						adminid: adminid,
						adminkey: adminkey
					},
					success: function(e) {
						var Data = e;
						checkError(Data);
						console.log(Data)
						var inner = '<option value="">请选择业务员</option>'
						Data.body.forEach(function(q) {
							inner += '<option value="' + q.user_id + '">' + q.user_name + '</option>'
						})
						document.getElementById('querybyywy').innerHTML = inner
						form.render('select');
					},
					error: function(e) {
						console.log('查询失败')
						console.log(e)
					}
				})
			}
			//12个字段
			function addhouse() {
				var title = $('#title').val().toString().trim();
				var area_id = $('#area').val();
				var address = $('#address').val().toString().trim();
				var totalarea = $('#totalarea').val().toString().trim();
				var price = $('#price').val().toString().trim();
				var unit = $('#unit').val().toString().trim();
				var height = $('#height').val().toString().trim();
				var saleuser = $('#querybyywy').val();
				var totalfloor = $('#totalfloor').val().toString().trim();
				var floor = $('#floor').val().toString().trim();
				var elec_flg = $('#elec_flg').val();
				var soldflg = $('#soldflg').val();
				var houseintroduction = $('#houseintroduction').val().toString().trim();
				var createuser = adminid;
				$.ajax({
					type: "post",
					url: '/ESFWeb/house/insert.jsp',
					datatype: 'json',
					data: {
						title: title,
						area_id: area_id,
						address: address,
						totalarea: totalarea,
						price: price,
						unit: unit,
						height: height,
						saleuser: saleuser,
						totalfloor: totalfloor,
						floor: floor,
						elec_flg: elec_flg,
						soldflg: soldflg,
						houseintroduction: houseintroduction,
						createuser: createuser,
					},
					success: function(e) {
						var newData = e
						layer.alert(newData.msg, {
							icon: 1,
							closeBtn: 0
						}, function(index) {
							//关闭保存成功页面
							layer.close(index);
							//获得当前页面索引
							var indexmain = parent.layer.getFrameIndex(window.name);
							//触发主页面按钮事件,根据不同业务可以在自己页面中修改方法
							parent.getSearchData()
							parent.layer.close(indexmain)
						})
					},
					error: function(e) {
						layer.alert(e.msg, {
							icon: 5,
							closeBtn: 0
						}, function(index) {
							//关闭保存成功页面
							layer.close(index);
							//获得当前页面索引
							var indexmain = parent.layer.getFrameIndex(window.name);
							//触发主页面按钮事件,根据不同业务可以在自己页面中修改方法
							parent.getSearchData()
							parent.layer.close(indexmain)
						})
					}
				})
			}

			function reset() {
				$('#title').val('')
				$('#address').val('')
				$('#totalarea').val('');
				$('#price').val('');
				$('#unit').val('');
				$('#height').val('');
				$('#totalfloor').val('');
				$('#floor').val('');
				$('houseintroduction').val('');
			}

		</script>
	</body>
</html>
